{
  "$id": "schema.attest.capsule.invoke.royal_flush.v1",
  "type": "object",
  "required": [
    "frame_id",
    "capsule_id",
    "manifest_hash",
    "alg",
    "quorum",
    "signers",
    "attester",
    "anti_replay",
    "bindings",
    "status"
  ],
  "properties": {
    "frame_id": { "const": "attest.capsule.invoke.royal_flush.v1" },
    "capsule_id": { "const": "capsule.invoke.royal_flush.v1" },
    "manifest_hash": { "type": "string", "pattern": "^sha256:[0-9a-f]{64}$" },
    "alg": { "const": "Ed25519" },
    "quorum": {
      "type": "object",
      "required": ["required", "total", "policy"],
      "properties": {
        "required": { "type": "integer", "minimum": 1 },
        "total": { "type": "integer", "minimum": 1 },
        "policy": { "type": "string" }
      }
    },
    "signers": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["node_id", "key_fingerprint", "signature"],
        "properties": {
          "node_id": { "type": "string" },
          "key_fingerprint": { "type": "string", "pattern": "^ed25519:[0-9a-f]{64}$" },
          "signature": { "type": "string", "pattern": "^base64:[A-Za-z0-9+/=]+$" }
        }
      }
    },
    "attester": {
      "type": "object",
      "required": ["role", "key_fingerprint", "counter_signature"],
      "properties": {
        "role": { "enum": ["Scrollsmith"] },
        "key_fingerprint": { "type": "string", "pattern": "^ed25519:[0-9a-f]{64}$" },
        "counter_signature": { "type": "string", "pattern": "^base64:[A-Za-z0-9+/=]+$" }
      }
    },
    "anti_replay": {
      "type": "object",
      "required": ["nonce", "timestamp", "clock_source", "replay_window_s"],
      "properties": {
        "nonce": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" },
        "clock_source": { "const": "scrollstream" },
        "replay_window_s": { "type": "integer", "minimum": 1 }
      }
    },
    "bindings": {
      "type": "object",
      "required": ["auth_scope", "invocation_type", "parent", "links"],
      "properties": {
        "auth_scope": { "const": "cockpit.HUD.slot.royal_flush" },
        "invocation_type": { "enum": ["direct"] },
        "parent": { "type": "string" },
        "links": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "status": { "enum": ["SEALED"] }
  },
  "additionalProperties": false
}
